<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CHCL Stock Price Prediction</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f7fa;
        color: #333;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1, h2 { color: #2c3e50; margin-bottom: 20px; }

      .graph-container {
        margin-bottom: 40px;
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 8px;
        background-color: #fafafa;
        text-align: center;
      }

      img {
        width: 100%;
        height: auto;
        max-width: 100%;
        border-radius: 4px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }

      .messages {
        list-style: none;
        padding: 0;
        margin: 20px 0;
      }

      .messages li {
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 10px;
        font-weight: 500;
      }

      .messages li.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
      .messages li.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
      .messages li.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

      button {
        padding: 14px 28px;
        font-size: 18px;
        background-color: #3498db;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.3s;
      }

      button:hover { background-color: #2980b9; }
      button:disabled { background-color: #95a5a6; cursor: not-allowed; }

      /* Loading Overlay */
      #loading-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.75);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        font-size: 20px;
      }

      .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      @media (max-width: 768px) {
        button { width: 100%; padding: 16px; }
        #loading-overlay p { padding: 0 20px; font-size: 16px; }
      }
    </style>
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
      <div class="spinner"></div>
      <p>Your model is training...<br>This may take 30â€“90 seconds. Please wait.</p>
    </div>

    <div class="container">
      <h1>CHCL Stock Price Prediction</h1>

      <!-- Messages -->
      {% if messages %}
      <ul class="messages">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %}

      <!-- Backtest Chart -->
      {% if chart_image %}
      <h2>Backtest Results: Real vs Predicted</h2>
      <div class="graph-container">
        <img src="{{ chart_image }}" alt="Backtest Results" />
      </div>
      {% else %}
      <p><em>Train the model to see backtest results.</em></p>
      {% endif %}

      <!-- Forecast Chart -->
      {% if forecast_chart %}
      <h2>30-Day Future Forecast</h2>
      <div class="graph-container">
        <img src="{{ forecast_chart }}" alt="30-Day Forecast" />
      </div>
      {% else %}
      <p><em>Train the model to see future forecast.</em></p>
      {% endif %}

      <!-- Train Button -->
      <h2>Train AI Model</h2>
      <p>Click the button to train the hybrid LSTM + XGBoost model.</p>

      <form method="post" id="train-form">
        {% csrf_token %}
        <input type="hidden" name="train_model" value="1">  <!-- Required for view detection -->
        <button type="submit" id="train-btn">Start Training Model</button>
      </form>

      <br><br>
      <small>Do not refresh during training. Results appear automatically after.</small>
    </div>

    <script>
      const form = document.getElementById('train-form');
      const overlay = document.getElementById('loading-overlay');
      const btn = document.getElementById('train-btn');

      // Show loading only on form submit
      form.addEventListener('submit', function() {
        overlay.style.display = 'flex';
        btn.disabled = true;
        btn.textContent = 'Training in Progress...';
      });

      // On every page load (including redirect), reset everything
      window.addEventListener('load', function() {
        overlay.style.display = 'none';
        btn.disabled = false;
        btn.textContent = 'Start Training Model';
      });
    </script>
  </body>
</html>